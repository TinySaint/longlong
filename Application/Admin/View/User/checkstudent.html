<extend name="Index:index"/>

<block name="right">
    <form class="form-horizontal" role="form" action="__URL__/updateinfo" method="post">
        <input type="hidden" name="sid" id="sid" value="{$student['sid']}">
        <div class="form-group" align="center">
            <label class="col-sm-2 control-label ">学生名字:</label>
            <div class="col-sm-2">
                <input type="text" class="form-control" name="name" id="name"
                       value="{$student['name']}">
            </div>
            <label class="col-sm-1 control-label ">性别:</label>
            <div class="col-sm-2">
                <select name="gender" class="form-control">
                    <option
                    <if condition="$student['gender'] eq '男'">selected='selected'</if>
                    >男</option>
                    <option
                    <if condition="$student['gender'] eq '女'">selected='selected'</if>
                    >女
                    </option>
                </select>
            </div>

            <label class="col-sm-2 control-label" style="width: 100px">出生日期:</label>
            <div class="col-sm-3">
                <input type="date" class="form-control" name="dataofbirth" value="{$student['dataofbirth']}">
            </div>


        </div>
        <div class="form-group">
            <label class="col-md-2 control-label ">顾问:</label>
            <div class="col-sm-2">
                <!--<input type="text" class="form-control" name="introducename"-->
                <!--value="{$student['introducename']}">-->
                <eq name="Think.session.admin_type" value="0">
                    <select name="introducename" class="form-control">
                        <if condition="$student['introduceid'] eq 0">
                            <option value="0">无</option>
                        </if>
                        <volist name="introducelist" id="vo">
                            <option value="{$vo['uid']}"
                            <if condition="$student['introduceid'] eq $vo['uid']">selected='selected'</if>
                            >{$vo['username']}</option>
                        </volist>
                    </select>
                    <else/>
                    <input type="hidden" name="introducename" value="{$student['introducename']}"/>
                    <div type="text" class="form-control" name="introducename"
                    >{$student['introducename']}
                    </div>
                </eq>

            </div>

            <label class="col-md-2 control-label ">固定电话:</label>
            <div class="col-sm-3">
                <input type="text" class="form-control" name="fixedline" value="{$student['fixedline']}">
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-2 control-label ">QQ:</label>
            <div class="col-sm-2">
                <input type="text" class="form-control" name="qq" value="{$student['qq']}">
            </div>
            <label class="col-sm-2 control-label ">手机:</label>
            <div class="col-sm-3">
                <eq name="Think.session.admin_type" value="0">
                    <input type="text" class="form-control" name="telephone" value="{$student['telephone']}">
                    <else/>
                    <input type="hidden" class="form-control" name="telephone" value="{$student['telephone']}">
                    <div class="form-control" name="telephone" value="{$student['telephone']}">{$student['telephone']}
                    </div>
                </eq>
            </div>
        </div>

        <div class="form-group" align="center">
            <label class="col-sm-2 control-label ">户口所在地:</label>
            <div class="col-sm-5">
                <input type="text" class="form-control" name="registered" value="{$student['registered']}">
            </div>
            <div class="form-group">
                <label class="col-sm-1 control-label " style="width: 100px">资源编号:</label>
                <div class="col-sm-2">
                    <input type="text" class="form-control" name="infotype" value="{$student['infotype']}">
                </div>
            </div>
        </div>
        <div class="form-group" align="center">
            <label class="col-sm-2 control-label ">在读学校:</label>
            <div class="col-sm-5">
                <input type="text" class="form-control" name="university" value="{$student['university']}">
            </div>
            <div class="form-group">
                <label class="col-sm-1 control-label " style="width: 100px">文化程度:</label>
                <div class="col-sm-2">
                    <select name="education" class="form-control">
                        <option
                        <if condition="$student['education'] eq '大专以下'">selected='selected'</if>
                        >大专以下</option>
                        <option
                        <if condition="$student['education'] eq '大专'">selected='selected'</if>
                        >大专</option>
                        <option
                        <if condition="$student['education'] eq '本科'">selected='selected'</if>
                        >本科</option>
                        <option
                        <if condition="$student['education'] eq '研究生'">selected='selected'</if>
                        >研究生</option>
                        <option
                        <if condition="$student['education'] eq '博士'">selected='selected'</if>
                        >博士</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label ">专业:</label>
            <div class="col-sm-5">
                <input type="text" class="form-control" name="major"
                       value="{$student['major']}">
            </div>
            <div class="form-group">
                <label class="col-md-1 control-label ">Email:</label>
                <div class="col-md-3">
                    <input type="text" class="form-control" name="email" value="{$student['email']}">
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label ">毕业时间:</label>
            <div class="col-sm-3">
                <input type="date" class="form-control" name="graduatedate" value="{$student['graduatedate']}">
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">留学国家:</label>
                <div class="col-md-3">
                    <input type="text" class="form-control" name="studyabroad" value="{$student['studyabroad']}">
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label ">留学时间:</label>
            <div class="col-sm-3">
                <input type="date" class="form-control" name="abroaddate" value="{$student['abroaddate']}">
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">平均成绩:</label>
                <div class="col-md-3">
                    <input type="text" class="form-control" name="grade" value="{$student['grade']}">
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label ">文案老师:</label>
            <div class="col-sm-3">
                <select name="fileteacherid" class="form-control">
                    <option value="">无</option>
                    <volist name="fileteacherlist" id="vo">
                        <option <eq name="vo.uid" value="$student.fileteacherid">selected='selected'</eq> value="{$vo.uid}">{$vo['username']}</option>
                    </volist>
                </select>
            </div>

            <div class="form-group">
                <label class="col-md-2 control-label ">学生状态:</label>
                <div class="col-sm-2">
                    <select name="state" class="form-control" id="state">
                        <option value="1" <eq name="student.state" value="1">selected='selected'</eq>>无</option>
                        <option value="2" <eq name="student.state" value="2">selected='selected'</eq>>一星</option>
                        <option value="3" <eq name="student.state" value="3">selected='selected'</eq>>二星</option>
                        <option value="4" <eq name="student.state" value="4">selected='selected'</eq>>三星</option>
                        <option value="5" <eq name="student.state" value="5">selected='selected'</eq>>四星</option>
                        <option value="6" <eq name="student.state" value="6">selected='selected'</eq>>五星</option>
                        <option value="7" <eq name="student.state" value="7">selected='selected'</eq>>联系不上</option>
                        <option value="8" <eq name="student.state" value="8">selected='selected'</eq>>联系上</option>
                        <option value="9" <eq name="student.state" value="9">selected='selected'</eq>>约来访</option>
                        <option value="10" <eq name="student.state" value="10">selected='selected'</eq>>已来访</option>
                        <option value="11" <eq name="student.state" value="11">selected='selected'</eq>>待签约</option>
                        <option value="12" <eq name="student.state" value="12">selected='selected'</eq>>签约</option>
                        <option value="13" <eq name="student.state" value="13">selected='selected'</eq>>缴费（押金）</option>
                        <option value="14" <eq name="student.state" value="14">selected='selected'</eq>>缴费（首款）</option>
                        <option value="15" <eq name="student.state" value="15">selected='selected'</eq>>缴费（全款）</option>
                        <option value="16" <eq name="student.state" value="16">selected='selected'</eq>>通过</option>
                        <option value="17" <eq name="student.state" value="17">selected='selected'</eq>>退款</option>

                    </select>
                </div>
            </div>


        </div>
        <script>

            //监听上传进度
            $(document).ready(function () {

                $("#upfile").on('click', function () {
                    var formData = new FormData();// 自动搜索#form里面的name值不为空的input(注意：type=file的input会被搜索到，但不能携带文件流，所以在下面我主动添加进了formData) <=ie9不支持FormData
                    formData.append('file', $('#accessory')[0].files[0]);
                    formData.append('sid', $('#sid').val());
                    formData.append('name', $('#name').val());
//                formData.append('file', document.querySelector('[type=file]').files[0]);// 由于上面不会搜索到type=file的input，所以在这里将它主动添加到formData中(注意：需使用原生方式获取)
                    $.ajax({
                        type: 'post',
                        url: "__URL__/uploadfile",
                        data: formData,
                        dataType: 'json',
                        //用ajax的话：这几个参数应该是 要设置的：
                        cache: false,
                        enctype: 'multipart/form-data',
                        contentType: false,// 当有文件要上传时，此项是必须的，否则后台无法识别文件流的起始位置(详见：#1)
                        processData: false,// 是否序列化data属性，默认true(注意：false时type必须是post，详见：#2)
//                    xhr: xhrOnProgress(function (e) {// (详见：#3)
//                        var percent = e.loaded / e.total;//计算百分比
//                        $('#upfile').append('->' + percent);
//                    }),
                        success: function (response) {
                            if (response.status == 1) {
                                //判断返回的status来确定文件是否上传成功，以及上传成功后要做的操作
                                alert(response.msg);
                                $("#accessory").val("");
                                $("#filelistdiv").append("<p id='" + response.fid + "'><input type='checkbox' name='filelist' value='" + response.fid + "'/><a type='file' href='__URL__/downloadfile/fid/" + response.fid + "'>" + response.fname + "</a></p>");
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            alert("上传失败" + XMLHttpRequest.status + "---------" + XMLHttpRequest.readyState + "----------" + textStatus);
                        }
                    })
                });

                $("#detelefile").on('click', function () {

                    var arr = new Array();
                    var result = "";
                    var items = document.getElementsByName("filelist");
                    for (i = 0; i < items.length; i++) {
                        if (items[i].checked) {
                            arr.push(items[i].value);
                        }
                    }
                    console.log(arr[0]);
                    if (arr.length > 0) {
                        $.ajax({
                            url: "__URL__/deletefile",
                            //data: { "selectedIDs": _list },
                            data: {'flist': arr},
                            dataType: "json",
                            type: "POST",
                            //traditional: true,
                            success: function (responseJSON) {
                                // your logic
                                $.each(responseJSON.flist, function (name, value) {
                                    if (value = 1) {
                                        result = result + name + "删除成功 \n";
                                    } else {
                                        result = result + name + "删除失败 \n";
                                    }
                                });
                                $.each(responseJSON.fidlist, function (name, value) {
                                    if (value = 1) {
                                        $("p#" + name).remove();
                                    }
                                });
                                alert(result);
                            }
                        });
                    } else {
                        alert("请选择要删除的文件");
                    }
                });
            });
        </script>

        <div class="form-group" align="center">
            <label class="col-sm-2 control-label">文件列表:</label>
            <div class="col-sm-4">
                <div class="form-control" id="filelistdiv" style="height: 120px;padding-left: 20px" align="left">
                    <volist name="editfilelist" id="list">
                        <p id="{$list.fid}"><input type='checkbox' name='filelist' value="{$list.fid}"/><a type="file"
                                                                                                           href="__URL__/downloadfile/fid/{$list['fid']}">{$list['saccessory']}</a>
                        </p>
                    </volist>
                </div>
            </div>
            <eq name="Think.session.admin_type" value="0">
                <label class="col-sm-2 control-label">学生审核状态:</label>
                <div class="col-sm-2">
                    <select name="checkinfo" class="form-control">
                        <option value="1"
                        <eq name="student.checkinfo" value="1">checked='checked'</eq>
                        >修改信息</option>
                        <option value="2"
                        <eq name="student.checkinfo" value="2">checked='checked'</eq>
                        >审核不通过</option>
                        <option value="3"
                        <eq name="student.checkinfo" value="3">checked='checked'</eq>
                        >正在审核</option>
                        <option value="4"
                        <eq name="student.checkinfo" value="4">checked='checked'</eq>
                        >审核通过</option>
                        <option value="5"
                        <eq name="student.checkinfo" value="5">checked='checked'</eq>
                        >无效</option>
                    </select>
                </div>
            </eq>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label ">成绩附件:</label>
            <div class="col-sm-3">
                <input type="file" id="accessory" name="accessory" size="30">
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-2">
                <div class="btn btn-default" id="upfile" size="30">上传文件</div>
            </div>
            <div class="col-sm-1">
                <div class="btn btn-default" id="detelefile" size="30">删除文件</div>
            </div>
        </div>


        <!-- next state-->

        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion"
                   href="#collapseOne">
                    <h2 align="center"> 显示英语成绩 </h2>
                </a>
            </h4>
        </div>
        <div id="collapseOne" class="panel-collapse collapse">
            <div class="form-group">
                <label class="col-md-2 control-label ">SAT1:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="sat1" value="{$student['sat1']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="sat1date" value="{$student['sat1date']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">SAT2:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="sat2" value="{$student['sat2']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="sat2date" value="{$student['sat2date']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">TOEFL:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="toefl" value="{$student['toefl']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="toefldate" value="{$student['toefldate']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">TELTS:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="telts" value="{$student['telts']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="teltsdate" value="{$student['teltsdate']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">GMAT:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="gmat" value="{$student['gmat']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="gmatdate" value="{$student['gmatdate']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">GRE:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="grt" value="{$student['grt']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="grtdate" value="{$student['grtdate']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">LSAT:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="lsat" value="{$student['lsat']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="lsatdata" value="{$student['lsatdata']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
        </div>
        <div class="form-group">
                <div class="col-md-offset-3 col-md-5">
                    <button type="submit" class="btn btn-default">修改信息</button>
                </div>


            <div class="col-md-3">
                <button type="reset" class="btn btn-danger">重置</button>
            </div>
        </div>
    </form>
    <div class="panel panel-default">


        <div class="panel-heading">
            <p class="pl" type="button">评论</p>
        </div>

        <div class="panel-body">
            <div class="well">
                <form class="form-horizontal" action="{:U('Admin/Comment/addComment')}" method="post" role="form">
                    <input type="hidden" name="inputstate" value="{$student['checkinfo']}">
                    <div class="form-group" align="center">
                        <label class="col-sm-2 control-label ">评论人:</label>
                        <div class="col-sm-2">
                            <p class="control-label"> {$Think.session.admin_username}</p>
                            <input type="hidden" class="form-control" placeholder="昵称" name="author" id="author"
                                   value="{$Think.session.admin_username}">
                            <input type="hidden" class=" input-group" placeholder="" name="pid" value="0">
                            <input type="hidden" class=" input-group" placeholder="" name="sid"
                                   value="{$student['sid']}">
                        </div>
                    </div>
                    <div class="form-group" align="center">
                        <label class="col-sm-2 control-label ">评语:</label>
                        <div class="col-sm-10">
                            <textarea type="text" rows="5" id="content-text" name="comment" class="form-control"
                                      style="resize:none" placeholder="请输入评论内容"></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-offset-2 col-md-6">
                            <button type="submit" class="btn btn-default tjbtn">提交</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <input type="hidden" name="pid" value="{$vo.author}"/>
    <div>
        <h2></h2>
        <volist name="commentList" id="vo">
            <eq name="vo.pid" value="0">
                <hr class="solidline"/>
                <else/>
                <hr class="dottedline"/>
            </eq>
            <div class="commentList " style="padding-left:{$vo['level']-1}cm">
                <div><span class="user">
                            <if condition="($vo.pauthor eq NULL)">{$vo.author}
                                <else/> {$vo.author}<span class="black" style="color: #000101">回复</span>{$vo.pauthor}
                            </if>
                        </span>
                    <eq name="Think.session.admin_type" value="0">
                        <a href="__APP__/Admin/Comment/deteleComment/id/{$vo.id}" id="{$vo.id}"
                           style="float: right">删除</a>
                    </eq>
                    <span class="hftime">{$vo.time|date="Y-m-d H:i:s",###}</span>
                </div>
                <div class="content">{$vo.content}</div>

            </div>

        </volist>
    </div>
    <div style="height: 200px"/>

    <div class="clear"></div>
    <!-- 清除浮动 -->
    <script type="text/javascript">
        $(document).ready(function () {
//            $("#collapseOne").hide();
//            $("#english").click(function () {
//                $("#toggle").toggle();
            $(".hf").click(//点击回复按钮事件
                function (e) {
                    var $this = $(this);
                    if ($this.parent().parent().next().hasClass('hftext')) {
                        $this.parent().parent().next().remove();
                    } else {
                        $this.parent().parent().after('<div class="hftext"><form class="form-horizontal" action="__APP__/Admin/Comment/addComment" method="post" role="form"> <div class="form-group" align="center"> <label class="col-sm-2 control-label ">回复人:</label> <div class="col-sm-2"> <p class="control-label">  {$Think.session.admin_username}</p><input  type="hidden" class="form-control" placeholder="昵称" name="author"value="{$Think.session.admin_username}"> <input type="hidden" class=" input-group" placeholder="" id="pid" name="pid" value="{$vo.id}"> <input type="hidden" class=" input-group" placeholder="" id="sid" name="sid" value="{$student[\"sid\"]}"> </div></div><div class="form-group" align="center"><label class="col-sm-2 control-label ">回复:</label> <div class="col-sm-10"> <textarea type="text" rows="5" id="content-text" name="comment" class="form-control" style="resize:none" placeholder="请输入评论内容"></textarea> </div> </div><div class="form-group"><div class="col-md-offset-2 col-md-6"> <button type="submit" class="btn btn-default tjbtn">提交</button> </div> </div> </form></div>');
//                        $this.parent().parent().after('<div class="hftext"><form action="{:U('
//                        Home / Index / addComment
//                        ')}" method="post" role="form" > <input name="article_id" type="hidden"  value="{$Article.id}" /><input id="pid" type="hidden" name="pid" value="{$vo.id}"/> <div class="input-group home-from-box"><span class="input-group">昵称</span><input type="text" class="input-group name1" placeholder="昵称" name="username" value="{$username}"></div><div class="input-group"> <span class="input-group emotion2">表情</span>  </div><div class="input-group">  <textarea style="display: inline" class="input-group comment" id="content-text2" name="comment" rows="3" placeholder="请输入评论内容"></textarea>  </div><div class="submit">  <input style="width:100px;height:35px "  class="submit-btn" type="submit" value="提交"></div> </form></div>'
//                    )"
                        var v_id = $(e.target).attr('id');//获取元素id;
                        $("#pid").val(v_id);
//                        alert(v_id + "------");
                        $('.emotion2').qqFace({
                            id: 'facebox', //表情ID
                            assign: 'content-text2', //赋予到具体位置
                            path: '../../comment/Public/Face/'   //表情路径
                        });
                    }

                    $(".tjbtn").click(function () {
                        var $this = $(this);
                        var content = $this.parent().parent().siblings().find('#content-text').val();
                        alert("-1-" + content);
                        if (content == "") {
                            alert("昵称或者评论不能为空哦");
                            return false;
                        }
                    });
                });
            $(".tjbtn").click(function () {
                var $this = $(this);
                var content = $this.parent().parent().siblings().find('#content-text').val();
                if (content == "") {
                    alert("昵称或者评论不能为空哦");
                    return false;
                }
            });
        });


        //        $(function () {
        //            $('.emotion').qqFace({
        //                id: 'facebox', //表情ID
        //                assign: 'content-text', //赋予到具体位置
        //                path: '../../comment/Public/Face/'    //表情路径
        //            });


        //        });
    </script>


</block>