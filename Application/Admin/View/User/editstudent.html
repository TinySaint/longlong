<extend name="Index:index"/>

<block name="right">
    <form class="form-horizontal" role="form" action="__URL__/updateinfo" method="post">
        <input type="hidden" name="sid" id="sid" value="{$student['sid']}">
        <div class="form-group" align="center">
            <label class="col-sm-2 control-label ">学生名字:</label>
            <div class="col-sm-2">
                <input type="text" class="form-control" name="name" id="name"
                       value="{$student['name']}">
            </div>
            <label class="col-sm-1 control-label ">性别:</label>
            <div class="col-sm-2">
                <select name="gender" class="form-control">
                    <option
                    <if condition="$student['gender'] eq '男'">selected='selected'</if>
                    >男</option>
                    <option
                    <if condition="$student['gender'] eq '女'">selected='selected'</if>
                    >女
                    </option>
                </select>
            </div>

            <label class="col-sm-2 control-label" style="width: 100px">出生日期:</label>
            <div class="col-sm-3">
                <input type="date" class="form-control" name="dataofbirth" value="{$student['dataofbirth']}">
            </div>


        </div>
        <div class="form-group">
            <label class="col-md-2 control-label ">顾问:</label>
            <div class="col-sm-2">
                <!--<input type="text" class="form-control" name="introducename"-->
                <!--value="{$student['introducename']}">-->
                <eq name="Think.session.admin_type" value="0">
                    <select name="introducename" class="form-control">
                        <volist name="userlist" id="vo">
                            <option
                            <if condition="$student['introducename'] eq $vo['username']">selected='selected'</if>
                            >{$vo['username']}</option>
                        </volist>
                    </select>
                    <else/>
                    <input type="hidden" name="introducename" value="{$student['introducename']}"/>
                    <div type="text" class="form-control" name="introducename"
                    >{$student['introducename']}
                    </div>
                </eq>

            </div>

            <label class="col-md-2 control-label ">固定电话:</label>
            <div class="col-sm-3">
                <input type="text" class="form-control" name="fixedline" value="{$student['fixedline']}">
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-2 control-label ">QQ:</label>
            <div class="col-sm-2">
                <input type="text" class="form-control" name="qq" value="{$student['qq']}">
            </div>
            <label class="col-sm-2 control-label ">手机:</label>
            <div class="col-sm-3">
                <input type="text" class="form-control" name="telephone" value="{$student['telephone']}">
            </div>
        </div>

        <div class="form-group" align="center">
            <label class="col-sm-2 control-label ">户口所在地:</label>
            <div class="col-sm-5">
                <input type="text" class="form-control" name="registered" value="{$student['registered']}">
            </div>
            <div class="form-group">
                <label class="col-sm-1 control-label " style="width: 100px">资源编号:</label>
                <div class="col-sm-2">
                    <input type="text" class="form-control" name="infotype" value="{$student['infotype']}">
                </div>
            </div>
        </div>
        <div class="form-group" align="center">
            <label class="col-sm-2 control-label ">在读学校:</label>
            <div class="col-sm-5">
                <input type="text" class="form-control" name="university" value="{$student['university']}">
            </div>
            <div class="form-group">
                <label class="col-sm-1 control-label " style="width: 100px">文化程度:</label>
                <div class="col-sm-2">
                    <select name="education" class="form-control">
                        <option
                        <if condition="$student['education'] eq '大专以下'">selected='selected'</if>
                        >大专以下</option>
                        <option
                        <if condition="$student['education'] eq '大专'">selected='selected'</if>
                        >大专</option>
                        <option
                        <if condition="$student['education'] eq '本科'">selected='selected'</if>
                        >本科</option>
                        <option
                        <if condition="$student['education'] eq '研究生'">selected='selected'</if>
                        >研究生</option>
                        <option
                        <if condition="$student['education'] eq '博士'">selected='selected'</if>
                        >博士</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label ">专业:</label>
            <div class="col-sm-5">
                <input type="text" class="form-control" name="major"
                       value="{$student['major']}">
            </div>
            <div class="form-group">
                <label class="col-md-1 control-label ">Email:</label>
                <div class="col-md-3">
                    <input type="text" class="form-control" name="email" value="{$student['email']}">
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label ">毕业时间:</label>
            <div class="col-sm-3">
                <input type="date" class="form-control" name="graduatedate" value="{$student['graduatedate']}">
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">留学国家:</label>
                <div class="col-md-3">
                    <input type="text" class="form-control" name="studyabroad" value="{$student['studyabroad']}">
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label ">留学时间:</label>
            <div class="col-sm-3">
                <input type="date" class="form-control" name="abroaddate" value="{$student['abroaddate']}">
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">平均成绩:</label>
                <div class="col-md-3">
                    <input type="text" class="form-control" name="grade" value="{$student['grade']}">
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label ">文案老师:</label>
            <div class="col-sm-3">
                <select name="fileteacher" class="form-control">
                    <option>无</option>
                    <volist name="userlist" id="vo">
                        <option>{$vo['username']}</option>
                    </volist>
                </select>
            </div>

            <div class="form-group">
                <label class="col-md-2 control-label ">学生状态:</label>
                <div class="col-sm-2">
                    <select name="state" class="form-control">
                        <option value="1"
                        <eq name="student.state" value="1">selected='selected'</eq>
                        >无</option>
                        <option value="2"
                        <eq name="student.state" value="2">selected='selected'</eq>
                        >联系不上</option>
                        <option value="3"
                        <eq name="student.state" value="3">selected='selected'</eq>
                        >联系上</option>
                        <option value="4"
                        <eq name="student.state" value="4">selected='selected'</eq>
                        >约来访</option>
                        <option value="5"
                        <eq name="student.state" value="5">selected='selected'</eq>
                        >已来访</option>
                        <option value="6"
                        <eq name="student.state" value="6">selected='selected'</eq>
                        >待签约</option>
                        <eq name="Think.session.admin_type" value="0">
                            <option value="7"
                            <eq name="student.state" value="7">selected='selected'</eq>
                            >签约</option>
                            <option value="8"
                            <eq name="student.state" value="8">selected='selected'</eq>
                            >缴费（押金）</option>
                            <option value="9"
                            <eq name="student.state" value="9">selected='selected'</eq>
                            >缴费（首款）</option>
                            <option value="10"
                            <eq name="student.state" value="10">selected='selected'</eq>
                            >缴费（全款）</option>
                            <option value="11"
                            <eq name="student.state" value="11">selected='selected'</eq>
                            >无效</option>
                        </eq>
                    </select>
                </div>
            </div>


        </div>
        <script>

            //监听上传进度
            $(document).ready(function () {
//            var xhrOnProgress = function (fun) {
//                xhrOnProgress.onprogress = fun; //绑定监听
//                return function () {
//                    //通过$.ajaxSettings.xhr();获得XMLHttpRequest对象
//                    var xhr = $.ajaxSettings.xhr();
//                    //判断监听函数是否为函数
//                    if (typeof xhrOnProgress.onprogress !== 'function')
//                        return xhr;
//                    //如果有监听函数并且xhr对象支持绑定时就把监听函数绑定上去
//                    if (xhrOnProgress.onprogress && xhr.upload) {
//                        xhr.upload.onprogress = xhrOnProgress.onprogress;
//                    }
//                    return xhr;
//                }
//            };

                $("#upfile").on('click', function () {
                    var formData = new FormData();// 自动搜索#form里面的name值不为空的input(注意：type=file的input会被搜索到，但不能携带文件流，所以在下面我主动添加进了formData) <=ie9不支持FormData
                    formData.append('file', $('#accessory')[0].files[0]);
                    formData.append('sid', $('#sid').val());
                    formData.append('name', $('#name').val());
//                formData.append('file', document.querySelector('[type=file]').files[0]);// 由于上面不会搜索到type=file的input，所以在这里将它主动添加到formData中(注意：需使用原生方式获取)
                    $.ajax({
                        type: 'post',
                        url: "__URL__/uploadfile",
                        data: formData,
                        dataType: 'json',
                        //用ajax的话：这几个参数应该是 要设置的：
                        cache: false,
                        enctype: 'multipart/form-data',
                        contentType: false,// 当有文件要上传时，此项是必须的，否则后台无法识别文件流的起始位置(详见：#1)
                        processData: false,// 是否序列化data属性，默认true(注意：false时type必须是post，详见：#2)
//                    xhr: xhrOnProgress(function (e) {// (详见：#3)
//                        var percent = e.loaded / e.total;//计算百分比
//                        $('#upfile').append('->' + percent);
//                    }),
                        success: function (response) {
                            if (response.status == 1) {
                                //判断返回的status来确定文件是否上传成功，以及上传成功后要做的操作
                                alert(response.msg);
                                $("#accessory").val("");
                                $("#filelistdiv").append("<p id='" + response.fid + "'><input type='checkbox' name='filelist' value='" + response.fid + "'/>" + response.fname + "</p>");
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            alert("上传失败" + XMLHttpRequest.status + "---------" + XMLHttpRequest.readyState + "----------" + textStatus);
                        }
                    })
                });

                $("#detelefile").on('click', function () {

                    var arr = new Array();
                    var result = "";
                    var items = document.getElementsByName("filelist");
                    for (i = 0; i < items.length; i++) {
                        if (items[i].checked) {
                            arr.push(items[i].value);
                        }
                    }
                    console.log(arr[0]);
                    if (arr.length > 0) {
                        $.ajax({
                            url: "__URL__/deletefile",
                            //data: { "selectedIDs": _list },
                            data: {'flist': arr},
                            dataType: "json",
                            type: "POST",
                            //traditional: true,
                            success: function (responseJSON) {
                                // your logic
                                $.each(responseJSON.flist, function (name, value) {
                                    if (value = 1) {
                                        result = result + name + "删除成功 \n";
                                    } else {
                                        result = result + name + "删除失败 \n";
                                    }
                                });
                                $.each(responseJSON.fidlist, function (name, value) {
                                    if (value = 1) {
                                        $("p#" + name).remove();
                                    }
                                });
                                alert(result);
                            }
                        });
                    } else {
                        alert("请选择要删除的文件");
                    }
                });
            });
        </script>

        <div class="form-group" align="center">
            <label class="col-sm-2 control-label">文件列表:</label>
            <div class="col-sm-4">
                <div class="form-control" id="filelistdiv" style="height: 120px;padding-left: 20px" align="left">
                    <volist name="editfilelist" id="list">
                        <p id="{$list.fid}"><input type='checkbox' name='filelist' value="{$list.fid}"/>{$list.saccessory}
                        </p>
                    </volist>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-md-2 control-label ">成绩附件:</label>
            <div class="col-sm-3">
                <input type="file" id="accessory" name="accessory" size="30">
            </div>
            <div class="col-sm-1">
                <div class="btn btn-default" id="upfile" size="30">上传</div>
            </div>
            <div class="col-sm-1">
                <div class="btn btn-default" id="detelefile" size="30">删除</div>
            </div>
        </div>

        <!-- next state-->

        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion"
                   href="#collapseOne">
                    <h2 align="center"> 显示英语成绩 </h2>
                </a>
            </h4>
        </div>
        <div id="collapseOne" class="panel-collapse collapse">
            <div class="form-group">
                <label class="col-md-2 control-label ">SAT1:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="sat1" value="{$student['sat1']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="sat1date" value="{$student['sat1date']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">SAT2:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="sat2" value="{$student['sat2']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="sat2date" value="{$student['sat2date']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">TOEFL:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="toefl" value="{$student['toefl']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="toefldate" value="{$student['toefldate']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">TELTS:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="telts" value="{$student['telts']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="teltsdate" value="{$student['teltsdate']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">GMAT:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="gmat" value="{$student['gmat']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="gmatdate" value="{$student['gmatdate']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">GRE:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="grt" value="{$student['grt']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="grtdate" value="{$student['grtdate']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label ">LSAT:</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" name="lsat" value="{$student['lsat']}">
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label " style="width: 100px">考试时间:</label>
                    <div class="col-md-3">
                        <input type="date" class="form-control" name="lsatdata" value="{$student['lsatdata']}">
                    </div>
                    <p>(如未考，请选择考试时间！)</p>
                </div>
            </div>
        </div>
        <div class="form-group">
            <lt name="Think.session.admin_type" value="2">
                <div class="col-md-offset-3 col-md-5">
                    <button type="submit" class="btn btn-default">修改信息</button>
                </div>
                <else/>
                <div class="col-md-offset-3 col-md-5">
                    <button type="submit" class="btn btn-default">提交审核</button>
                </div>
            </lt>

            <div class="col-md-3">
                <button type="reset" class="btn btn-danger">重置</button>
            </div>
        </div>
        <div style="height: 200px;"></div>
    </form>
</block>